<!doctype html><html lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Liste - https://theden.github.io/thoughts.theden.sh/"><title>Improve docker volume performance on MacOS with a RAM disk | thoughts</title><meta name=description content><meta property="og:title" content="Improve docker volume performance on MacOS with a RAM disk"><meta property="og:description" content="Primer Hardware Setup Random Read and write performance Standard volume RAM Disk I/0 latency Standard volume RAM Disk Cleanup Results Primer # Whilst docker does support tmpfs natively, it&rsquo;s only available if you&rsquo;re running docker on linux. A use-case for using a ram disk, as described in the documentation:
If your container generates non-persistent state data, consider using a tmpfs mount to avoid storing the data anywhere permanently, and to increase the container’s performance by avoiding writing into the container’s writable layer."><meta property="og:type" content="article"><meta property="og:url" content="https://theden.github.io/thoughts.theden.sh/posts/docker-ramdisk-macos-benchmark/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-27T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-27T00:00:00+00:00"><meta itemprop=name content="Improve docker volume performance on MacOS with a RAM disk"><meta itemprop=description content="Primer Hardware Setup Random Read and write performance Standard volume RAM Disk I/0 latency Standard volume RAM Disk Cleanup Results Primer # Whilst docker does support tmpfs natively, it&rsquo;s only available if you&rsquo;re running docker on linux. A use-case for using a ram disk, as described in the documentation:
If your container generates non-persistent state data, consider using a tmpfs mount to avoid storing the data anywhere permanently, and to increase the container’s performance by avoiding writing into the container’s writable layer."><meta itemprop=datePublished content="2022-06-27T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-27T00:00:00+00:00"><meta itemprop=wordCount content="1165"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Improve docker volume performance on MacOS with a RAM disk"><meta name=twitter:description content="Primer Hardware Setup Random Read and write performance Standard volume RAM Disk I/0 latency Standard volume RAM Disk Cleanup Results Primer # Whilst docker does support tmpfs natively, it&rsquo;s only available if you&rsquo;re running docker on linux. A use-case for using a ram disk, as described in the documentation:
If your container generates non-persistent state data, consider using a tmpfs mount to avoid storing the data anywhere permanently, and to increase the container’s performance by avoiding writing into the container’s writable layer."><link rel=canonical href=https://theden.github.io/thoughts.theden.sh/posts/docker-ramdisk-macos-benchmark/><meta name=monetization content="$twitter.xrptipbot.com/ronaldsvilcins"><link rel=dns-prefetch href=https://www.google-analytics.com><link href=https://www.google-analytics.com rel=preconnect crossorigin><link rel=alternate type=application/atom+xml title=thoughts href=https://theden.github.io/thoughts.theden.sh/atom.xml><link rel=alternate type=application/json title=thoughts href=https://theden.github.io/thoughts.theden.sh/feed.json><link rel="shortcut icon" type=image/png href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII="><link href=https://theden.github.io/thoughts.theden.sh/css/custom.css rel=stylesheet><link rel=stylesheet href=https://theden.github.io/thoughts.theden.sh/css/hype.css id=hype><script>document.getElementById("hype").disabled=!0</script><script src=https://theden.github.io/thoughts.theden.sh/js/custom.js></script>
<link rel='shortcut icon' href=/favicon.ico type=image/x-icon><style>*,:after,:before{box-sizing:border-box;padding:0}body{font:1rem/1.5 '-apple-system',BlinkMacSystemFont,avenir next,avenir,helvetica,helvetica neue,ubuntu,roboto,noto,segoe ui,arial,sans-serif;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;padding:2rem;color:#096}.skip-link{position:absolute;top:-40px;left:0;background:#eee;z-index:100}.skip-link:focus{top:0}h1,h2,h3,h4,h5,strong,b{font-size:inherit;font-weight:600}header{line-height:2;padding-bottom:1.5rem}.link{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.time{font-variant-numeric:tabular-nums;white-space:nowrap}blockquote{border-left:1px solid #096;padding-left:1rem;margin:0}a,a:visited{color:inherit}a:hover,a.heading-link{text-decoration:none}pre{padding:.5rem;overflow:auto;overflow-x:scroll;overflow-wrap:normal}code,pre{font-family:San Francisco Mono,Monaco,consolas,lucida console,dejavu sans mono,bitstream vera sans mono,monospace;font-size:normal;font-size:small}code{padding:0;border:none}ul{list-style-type:square}ul,ol{padding-left:1.2rem}.list{line-height:2;list-style-type:none;padding-left:0}.list li{padding-bottom:.1rem}.meta{color:#777}.content{max-width:70ch;margin:0 auto}header{line-height:2;display:flex;justify-content:space-between;padding-bottom:1rem}header a{text-decoration:none}header ul{list-style-type:none;padding:0}header li,header a{display:inline}h2.post{padding-top:.5rem}header ul a:first-child{padding-left:1rem}.nav{height:1px;background:#000;content:'';max-width:10%}.list li{display:flex;align-items:baseline}.list li time{flex:initial}.hr-list{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:0;border-bottom:1px dotted #096;flex:1 0 1rem}.m,hr{border:0;margin:3rem 0}img{max-width:100%;height:auto}</style><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","name":"Improve docker volume performance on MacOS with a RAM disk","headline":"Improve docker volume performance on MacOS with a RAM disk","alternativeHeadline":"","description":"Primer Hardware Setup Random Read and write performance Standard volume RAM Disk I\/0 latency Standard volume RAM Disk Cleanup Results Primer # Whilst docker does support tmpfs natively, it\u0026rsquo;s only available if you\u0026rsquo;re running docker on linux. A use-case for using a ram disk, as described in the documentation:\nIf your container generates non-persistent state data, consider using a tmpfs mount to avoid storing the data anywhere permanently, and to increase the container’s performance by avoiding writing into the container’s writable layer.","inLanguage":"en-us","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/theden.github.io\/thoughts.theden.sh\/posts\/docker-ramdisk-macos-benchmark\/"},"author":{"@type":"Person","name":""},"creator":{"@type":"Person","name":""},"accountablePerson":{"@type":"Person","name":""},"copyrightHolder":"thoughts","copyrightYear":"2022","dateCreated":"2022-06-27T00:00:00.00Z","datePublished":"2022-06-27T00:00:00.00Z","dateModified":"2022-06-27T00:00:00.00Z","publisher":{"@type":"Organization","name":"thoughts","url":"https://theden.github.io/thoughts.theden.sh/","logo":{"@type":"ImageObject","url":"https:\/\/theden.github.io\/thoughts.theden.sh\/","width":"32","height":"32"}},"image":"https://theden.github.io/thoughts.theden.sh/","url":"https:\/\/theden.github.io\/thoughts.theden.sh\/posts\/docker-ramdisk-macos-benchmark\/","wordCount":"1165","genre":[],"keywords":[]}</script><a class=skip-link href=#main>Skip to main</a><main id=main><div class=content><header><p style=padding:0;margin:0><a href=/><b>thoughts.theden.sh</b></a><ul style=padding:0;margin:0><li><a href=https://theden.sh>About</a></ul></header><hr class=hr-list style=padding:0;margin:0><div style=float:right;padding-top:1em><button onclick=hype() class=button-hype role=button>HYPE</button></div><h2 class=post>Improve docker volume performance on MacOS with a RAM disk</h2><ul><li><a href=#primer>Primer</a><li><a href=#hardware>Hardware</a><li><a href=#setup>Setup</a><li><a href=#random-read-and-write-performance>Random Read and write performance</a><ul><li><a href=#standard-volume>Standard volume</a><li><a href=#ram-disk>RAM Disk</a></ul><li><a href=#i0-latency>I/0 latency</a><ul><li><a href=#standard-volume-1>Standard volume</a><li><a href=#ram-disk-1>RAM Disk</a></ul><li><a href=#cleanup>Cleanup</a><li><a href=#results>Results</a></ul><h1 id=primer>Primer <a href=#primer class="hash g">#</a></h1><p>Whilst docker does support <a href=https://docs.docker.com/storage/tmpfs/>tmpfs</a> natively, it&rsquo;s only available if you&rsquo;re running docker on linux. A use-case for using a ram disk, as described in the documentation:<blockquote><p>If your container generates non-persistent state data, consider using a tmpfs mount to avoid storing the data anywhere permanently, and to increase the container’s performance by avoiding writing into the container’s writable layer.</blockquote><p>However, we can still create a RAM disk in MacOS and mount it within docker. I&rsquo;ll mount a RAM disk and a standard docker volume and measuring the performance of both to compare.<h1 id=hardware>Hardware <a href=#hardware class="hash g">#</a></h1><p>My M1 Macbook Air&rsquo;s current sysinfo (unrelated info redacted)<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$  system_profiler SPSoftwareDataType SPHardwareDataType SPNVMeDataType
</span></span><span style=display:flex><span>Software:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    System Software Overview:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      System Version: macOS 12.4 <span style=color:#f92672>(</span>21F79<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      Kernel Version: Darwin 21.5.0
</span></span><span style=display:flex><span>      Boot Volume: Macintosh HD
</span></span><span style=display:flex><span>      Boot Mode: Normal
</span></span><span style=display:flex><span>      Computer Name: &lt;REDACTED&gt;
</span></span><span style=display:flex><span>      User Name: &lt;REDACTED&gt;
</span></span><span style=display:flex><span>      Secure Virtual Memory: Enabled
</span></span><span style=display:flex><span>      System Integrity Protection: Enabled
</span></span><span style=display:flex><span>      Time since boot: &lt;REDACTED&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hardware:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Hardware Overview:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      Model Name: MacBook Air
</span></span><span style=display:flex><span>      Model Identifier: MacBookAir10,1
</span></span><span style=display:flex><span>      Chip: Apple M1
</span></span><span style=display:flex><span>      Total Number of Cores: <span style=color:#ae81ff>8</span> <span style=color:#f92672>(</span><span style=color:#ae81ff>4</span> performance and <span style=color:#ae81ff>4</span> efficiency<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      Memory: <span style=color:#ae81ff>16</span> GB
</span></span><span style=display:flex><span>      System Firmware Version: 7459.121.3
</span></span><span style=display:flex><span>      OS Loader Version: 7459.121.3
</span></span><span style=display:flex><span>      Serial Number <span style=color:#f92672>(</span>system<span style=color:#f92672>)</span>: &lt;REDACTED&gt;
</span></span><span style=display:flex><span>      Hardware UUID: &lt;REDACTED&gt;
</span></span><span style=display:flex><span>      Provisioning UDID: &lt;REDACTED&gt;
</span></span><span style=display:flex><span>      Activation Lock Status: Enabled
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>NVMExpress:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Apple SSD Controller:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        APPLE SSD AP1024Q:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          Capacity: <span style=color:#ae81ff>1</span> TB <span style=color:#f92672>(</span>1,000,555,581,440 bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          TRIM Support: Yes
</span></span><span style=display:flex><span>          Model: APPLE SSD AP1024Q
</span></span><span style=display:flex><span>          Revision: 387.120.
</span></span><span style=display:flex><span>          Serial Number: &lt;REDACTED&gt;
</span></span><span style=display:flex><span>          Detachable Drive: No
</span></span><span style=display:flex><span>          BSD Name: disk0
</span></span><span style=display:flex><span>          Partition Map Type: GPT <span style=color:#f92672>(</span>GUID Partition Table<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          Removable Media: No
</span></span><span style=display:flex><span>          S.M.A.R.T. status: Verified
</span></span><span style=display:flex><span>          Volumes:
</span></span><span style=display:flex><span>            disk0s1:
</span></span><span style=display:flex><span>              Capacity: 524.3 MB <span style=color:#f92672>(</span>524,288,000 bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              BSD Name: disk0s1
</span></span><span style=display:flex><span>              Content: Apple_APFS_ISC
</span></span><span style=display:flex><span>            disk0s2:
</span></span><span style=display:flex><span>              Capacity: 994.66 GB <span style=color:#f92672>(</span>994,662,584,320 bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              BSD Name: disk0s2
</span></span><span style=display:flex><span>              Content: Apple_APFS
</span></span><span style=display:flex><span>            disk0s3:
</span></span><span style=display:flex><span>              Capacity: 5.37 GB <span style=color:#f92672>(</span>5,368,664,064 bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              BSD Name: disk0s3
</span></span><span style=display:flex><span>              Content: Apple_APFS_Recovery 
</span></span><span style=display:flex><span>      
</span></span></code></pre></div><h1 id=setup>Setup <a href=#setup class="hash g">#</a></h1><p>First we create a regular folder within the NVMe mount to test the standard docker volume<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir ~/docker-test-volume/
</span></span></code></pre></div><p>Now we create a RAM disk on MacOS, in this case it will be 2GBs<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>diskutil erasevolume HFS+ <span style=color:#e6db74>&#39;ramdisk&#39;</span> <span style=color:#66d9ef>$(</span>hdiutil attach -nobrowse -nomount ram://4194304<span style=color:#e6db74>`</span><span style=color:#f92672>)</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>Started erase on disk7
</span></span><span style=display:flex><span>Unmounting disk
</span></span><span style=display:flex><span>Erasing
</span></span><span style=display:flex><span>Initialized /dev/rdisk7 as a <span style=color:#ae81ff>2</span> GB <span style=color:#66d9ef>case</span>-insensitive HFS Plus volume
</span></span><span style=display:flex><span>Mounting disk
</span></span><span style=display:flex><span>Finished erase on disk7 <span style=color:#f92672>(</span>ramdisk<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>Now we&rsquo;ll create an <code>alpine</code> docker container mounting both volumes and install the required benchmarking software<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -v <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span><span style=color:#e6db74>/docker-test-volume/:/std-volume&#34;</span> -v <span style=color:#e6db74>&#34;/Volumes/ramdisk/:/ramdisk&#34;</span> -it alpine sh
</span></span></code></pre></div><h1 id=random-read-and-write-performance>Random Read and write performance <a href=#random-read-and-write-performance class="hash g">#</a></h1><p>We&rsquo;ll be using <a href=https://github.com/axboe/fio>fio</a> for benchmarking read/write performance<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apk add ioping
</span></span></code></pre></div><h2 id=standard-volume>Standard volume <a href=#standard-volume class="hash g">#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/std-volume <span style=color:#75715e># fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=1G --readwrite=randrw --rwmixread=75</span>
</span></span><span style=display:flex><span>test: <span style=color:#f92672>(</span>g<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>: rw<span style=color:#f92672>=</span>randrw, bs<span style=color:#f92672>=(</span>R<span style=color:#f92672>)</span> 4096B-4096B, <span style=color:#f92672>(</span>W<span style=color:#f92672>)</span> 4096B-4096B, <span style=color:#f92672>(</span>T<span style=color:#f92672>)</span> 4096B-4096B, ioengine<span style=color:#f92672>=</span>libaio, iodepth<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span>fio-3.28
</span></span><span style=display:flex><span>Starting <span style=color:#ae81ff>1</span> process
</span></span><span style=display:flex><span>test: Laying out IO file <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> file / 1024MiB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Jobs: <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>f<span style=color:#f92672>=</span>1<span style=color:#f92672>)</span>: <span style=color:#f92672>[</span>m<span style=color:#f92672>(</span>1<span style=color:#f92672>)][</span>97.0%<span style=color:#f92672>][</span>r<span style=color:#f92672>=</span>34.2MiB/s,w<span style=color:#f92672>=</span>11.7MiB/s<span style=color:#f92672>][</span>r<span style=color:#f92672>=</span>8766,w<span style=color:#f92672>=</span><span style=color:#ae81ff>2996</span> IOPS<span style=color:#f92672>][</span>eta 00m:01s<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>test: <span style=color:#f92672>(</span>groupid<span style=color:#f92672>=</span>0, jobs<span style=color:#f92672>=</span>1<span style=color:#f92672>)</span>: err<span style=color:#f92672>=</span> 0: pid<span style=color:#f92672>=</span>16: Mon Jun <span style=color:#ae81ff>27</span> 23:20:11 <span style=color:#ae81ff>2022</span>
</span></span><span style=display:flex><span>  read: IOPS<span style=color:#f92672>=</span>6159, BW<span style=color:#f92672>=</span>24.1MiB/s <span style=color:#f92672>(</span>25.2MB/s<span style=color:#f92672>)(</span>768MiB/31900msec<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   bw <span style=color:#f92672>(</span>  KiB/s<span style=color:#f92672>)</span>: min<span style=color:#f92672>=</span> 2756, max<span style=color:#f92672>=</span>43405, per<span style=color:#f92672>=</span>99.89%, avg<span style=color:#f92672>=</span>24613.37, stdev<span style=color:#f92672>=</span>4898.59, samples<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span>
</span></span><span style=display:flex><span>   iops        : min<span style=color:#f92672>=</span>  689, max<span style=color:#f92672>=</span>10851, avg<span style=color:#f92672>=</span>6153.08, stdev<span style=color:#f92672>=</span>1224.62, samples<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span>
</span></span><span style=display:flex><span>  write: IOPS<span style=color:#f92672>=</span>2057, BW<span style=color:#f92672>=</span>8231KiB/s <span style=color:#f92672>(</span>8429kB/s<span style=color:#f92672>)(</span>256MiB/31900msec<span style=color:#f92672>)</span>; <span style=color:#ae81ff>0</span> zone resets
</span></span><span style=display:flex><span>   bw <span style=color:#f92672>(</span>  KiB/s<span style=color:#f92672>)</span>: min<span style=color:#f92672>=</span>  972, max<span style=color:#f92672>=</span>14605, per<span style=color:#f92672>=</span>99.90%, avg<span style=color:#f92672>=</span>8223.41, stdev<span style=color:#f92672>=</span>1703.56, samples<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span>
</span></span><span style=display:flex><span>   iops        : min<span style=color:#f92672>=</span>  243, max<span style=color:#f92672>=</span> 3651, avg<span style=color:#f92672>=</span>2055.63, stdev<span style=color:#f92672>=</span>425.84, samples<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span>
</span></span><span style=display:flex><span>  cpu          : usr<span style=color:#f92672>=</span>2.60%, sys<span style=color:#f92672>=</span>14.09%, ctx<span style=color:#f92672>=</span>327802, majf<span style=color:#f92672>=</span>0, minf<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>
</span></span><span style=display:flex><span>  IO depths    : 1<span style=color:#f92672>=</span>0.1%, 2<span style=color:#f92672>=</span>0.1%, 4<span style=color:#f92672>=</span>0.1%, 8<span style=color:#f92672>=</span>0.1%, 16<span style=color:#f92672>=</span>0.1%, 32<span style=color:#f92672>=</span>0.1%, &gt;<span style=color:#f92672>=</span>64<span style=color:#f92672>=</span>100.0%
</span></span><span style=display:flex><span>     submit    : 0<span style=color:#f92672>=</span>0.0%, 4<span style=color:#f92672>=</span>100.0%, 8<span style=color:#f92672>=</span>0.0%, 16<span style=color:#f92672>=</span>0.0%, 32<span style=color:#f92672>=</span>0.0%, 64<span style=color:#f92672>=</span>0.0%, &gt;<span style=color:#f92672>=</span>64<span style=color:#f92672>=</span>0.0%
</span></span><span style=display:flex><span>     complete  : 0<span style=color:#f92672>=</span>0.0%, 4<span style=color:#f92672>=</span>100.0%, 8<span style=color:#f92672>=</span>0.0%, 16<span style=color:#f92672>=</span>0.0%, 32<span style=color:#f92672>=</span>0.0%, 64<span style=color:#f92672>=</span>0.1%, &gt;<span style=color:#f92672>=</span>64<span style=color:#f92672>=</span>0.0%
</span></span><span style=display:flex><span>     issued rwts: total<span style=color:#f92672>=</span>196498,65646,0,0 short<span style=color:#f92672>=</span>0,0,0,0 dropped<span style=color:#f92672>=</span>0,0,0,0
</span></span><span style=display:flex><span>     latency   : target<span style=color:#f92672>=</span>0, window<span style=color:#f92672>=</span>0, percentile<span style=color:#f92672>=</span>100.00%, depth<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Run status group <span style=color:#ae81ff>0</span> <span style=color:#f92672>(</span>all jobs<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>   READ: bw<span style=color:#f92672>=</span>24.1MiB/s <span style=color:#f92672>(</span>25.2MB/s<span style=color:#f92672>)</span>, 24.1MiB/s-24.1MiB/s <span style=color:#f92672>(</span>25.2MB/s-25.2MB/s<span style=color:#f92672>)</span>, io<span style=color:#f92672>=</span>768MiB <span style=color:#f92672>(</span>805MB<span style=color:#f92672>)</span>, run<span style=color:#f92672>=</span>31900-31900msec
</span></span><span style=display:flex><span>  WRITE: bw<span style=color:#f92672>=</span>8231KiB/s <span style=color:#f92672>(</span>8429kB/s<span style=color:#f92672>)</span>, 8231KiB/s-8231KiB/s <span style=color:#f92672>(</span>8429kB/s-8429kB/s<span style=color:#f92672>)</span>, io<span style=color:#f92672>=</span>256MiB <span style=color:#f92672>(</span>269MB<span style=color:#f92672>)</span>, run<span style=color:#f92672>=</span>31900-31900msec
</span></span></code></pre></div><h2 id=ram-disk>RAM Disk <a href=#ram-disk class="hash g">#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/ramdisk <span style=color:#75715e># fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=1G --readwrite=randrw --rwmixread=75</span>
</span></span><span style=display:flex><span>test: <span style=color:#f92672>(</span>g<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>: rw<span style=color:#f92672>=</span>randrw, bs<span style=color:#f92672>=(</span>R<span style=color:#f92672>)</span> 4096B-4096B, <span style=color:#f92672>(</span>W<span style=color:#f92672>)</span> 4096B-4096B, <span style=color:#f92672>(</span>T<span style=color:#f92672>)</span> 4096B-4096B, ioengine<span style=color:#f92672>=</span>libaio, iodepth<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span>fio-3.28
</span></span><span style=display:flex><span>Starting <span style=color:#ae81ff>1</span> process
</span></span><span style=display:flex><span>test: Laying out IO file <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> file / 1024MiB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Jobs: <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>f<span style=color:#f92672>=</span>1<span style=color:#f92672>)</span>: <span style=color:#f92672>[</span>m<span style=color:#f92672>(</span>1<span style=color:#f92672>)][</span>100.0%<span style=color:#f92672>][</span>r<span style=color:#f92672>=</span>59.7MiB/s,w<span style=color:#f92672>=</span>20.3MiB/s<span style=color:#f92672>][</span>r<span style=color:#f92672>=</span>15.3k,w<span style=color:#f92672>=</span><span style=color:#ae81ff>5206</span> IOPS<span style=color:#f92672>][</span>eta 00m:00s<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>test: <span style=color:#f92672>(</span>groupid<span style=color:#f92672>=</span>0, jobs<span style=color:#f92672>=</span>1<span style=color:#f92672>)</span>: err<span style=color:#f92672>=</span> 0: pid<span style=color:#f92672>=</span>19: Mon Jun <span style=color:#ae81ff>27</span> 23:23:03 <span style=color:#ae81ff>2022</span>
</span></span><span style=display:flex><span>  read: IOPS<span style=color:#f92672>=</span>13.6k, BW<span style=color:#f92672>=</span>53.3MiB/s <span style=color:#f92672>(</span>55.9MB/s<span style=color:#f92672>)(</span>768MiB/14396msec<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   bw <span style=color:#f92672>(</span>  KiB/s<span style=color:#f92672>)</span>: min<span style=color:#f92672>=</span>19832, max<span style=color:#f92672>=</span>65368, per<span style=color:#f92672>=</span>99.48%, avg<span style=color:#f92672>=</span>54313.21, stdev<span style=color:#f92672>=</span>9848.89, samples<span style=color:#f92672>=</span><span style=color:#ae81ff>28</span>
</span></span><span style=display:flex><span>   iops        : min<span style=color:#f92672>=</span> 4958, max<span style=color:#f92672>=</span>16342, avg<span style=color:#f92672>=</span>13578.14, stdev<span style=color:#f92672>=</span>2462.20, samples<span style=color:#f92672>=</span><span style=color:#ae81ff>28</span>
</span></span><span style=display:flex><span>  write: IOPS<span style=color:#f92672>=</span>4560, BW<span style=color:#f92672>=</span>17.8MiB/s <span style=color:#f92672>(</span>18.7MB/s<span style=color:#f92672>)(</span>256MiB/14396msec<span style=color:#f92672>)</span>; <span style=color:#ae81ff>0</span> zone resets
</span></span><span style=display:flex><span>   bw <span style=color:#f92672>(</span>  KiB/s<span style=color:#f92672>)</span>: min<span style=color:#f92672>=</span> 6728, max<span style=color:#f92672>=</span>22208, per<span style=color:#f92672>=</span>99.50%, avg<span style=color:#f92672>=</span>18149.14, stdev<span style=color:#f92672>=</span>3321.62, samples<span style=color:#f92672>=</span><span style=color:#ae81ff>28</span>
</span></span><span style=display:flex><span>   iops        : min<span style=color:#f92672>=</span> 1682, max<span style=color:#f92672>=</span> 5552, avg<span style=color:#f92672>=</span>4537.14, stdev<span style=color:#f92672>=</span>830.41, samples<span style=color:#f92672>=</span><span style=color:#ae81ff>28</span>
</span></span><span style=display:flex><span>  cpu          : usr<span style=color:#f92672>=</span>6.59%, sys<span style=color:#f92672>=</span>33.55%, ctx<span style=color:#f92672>=</span>327779, majf<span style=color:#f92672>=</span>0, minf<span style=color:#f92672>=</span><span style=color:#ae81ff>14</span>
</span></span><span style=display:flex><span>  IO depths    : 1<span style=color:#f92672>=</span>0.1%, 2<span style=color:#f92672>=</span>0.1%, 4<span style=color:#f92672>=</span>0.1%, 8<span style=color:#f92672>=</span>0.1%, 16<span style=color:#f92672>=</span>0.1%, 32<span style=color:#f92672>=</span>0.1%, &gt;<span style=color:#f92672>=</span>64<span style=color:#f92672>=</span>100.0%
</span></span><span style=display:flex><span>     submit    : 0<span style=color:#f92672>=</span>0.0%, 4<span style=color:#f92672>=</span>100.0%, 8<span style=color:#f92672>=</span>0.0%, 16<span style=color:#f92672>=</span>0.0%, 32<span style=color:#f92672>=</span>0.0%, 64<span style=color:#f92672>=</span>0.0%, &gt;<span style=color:#f92672>=</span>64<span style=color:#f92672>=</span>0.0%
</span></span><span style=display:flex><span>     complete  : 0<span style=color:#f92672>=</span>0.0%, 4<span style=color:#f92672>=</span>100.0%, 8<span style=color:#f92672>=</span>0.0%, 16<span style=color:#f92672>=</span>0.0%, 32<span style=color:#f92672>=</span>0.0%, 64<span style=color:#f92672>=</span>0.1%, &gt;<span style=color:#f92672>=</span>64<span style=color:#f92672>=</span>0.0%
</span></span><span style=display:flex><span>     issued rwts: total<span style=color:#f92672>=</span>196498,65646,0,0 short<span style=color:#f92672>=</span>0,0,0,0 dropped<span style=color:#f92672>=</span>0,0,0,0
</span></span><span style=display:flex><span>     latency   : target<span style=color:#f92672>=</span>0, window<span style=color:#f92672>=</span>0, percentile<span style=color:#f92672>=</span>100.00%, depth<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Run status group <span style=color:#ae81ff>0</span> <span style=color:#f92672>(</span>all jobs<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>   READ: bw<span style=color:#f92672>=</span>53.3MiB/s <span style=color:#f92672>(</span>55.9MB/s<span style=color:#f92672>)</span>, 53.3MiB/s-53.3MiB/s <span style=color:#f92672>(</span>55.9MB/s-55.9MB/s<span style=color:#f92672>)</span>, io<span style=color:#f92672>=</span>768MiB <span style=color:#f92672>(</span>805MB<span style=color:#f92672>)</span>, run<span style=color:#f92672>=</span>14396-14396msec
</span></span><span style=display:flex><span>  WRITE: bw<span style=color:#f92672>=</span>17.8MiB/s <span style=color:#f92672>(</span>18.7MB/s<span style=color:#f92672>)</span>, 17.8MiB/s-17.8MiB/s <span style=color:#f92672>(</span>18.7MB/s-18.7MB/s<span style=color:#f92672>)</span>, io<span style=color:#f92672>=</span>256MiB <span style=color:#f92672>(</span>269MB<span style=color:#f92672>)</span>, run<span style=color:#f92672>=</span>14396-14396msec
</span></span></code></pre></div><h1 id=i0-latency>I/0 latency <a href=#i0-latency class="hash g">#</a></h1><p>We also can use <a href=https://github.com/koct9i/ioping>IOPing</a> to monitor I/O latency in real time, as a basic heuristic.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apk add ioping
</span></span></code></pre></div><h2 id=standard-volume-1>Standard volume <a href=#standard-volume-1 class="hash g">#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/std-volume <span style=color:#75715e># ioping -c 10 .</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> time<span style=color:#f92672>=</span>78.3 us <span style=color:#f92672>(</span>warmup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> time<span style=color:#f92672>=</span>396.4 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> time<span style=color:#f92672>=</span><span style=color:#ae81ff>369</span> us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> time<span style=color:#f92672>=</span>322.9 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> time<span style=color:#f92672>=</span>254.2 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> time<span style=color:#f92672>=</span>369.7 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>7</span> time<span style=color:#f92672>=</span><span style=color:#ae81ff>284</span> us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span> time<span style=color:#f92672>=</span>316.2 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>9</span> time<span style=color:#f92672>=</span>389.7 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span> time<span style=color:#f92672>=</span>308.2 us
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>--- . <span style=color:#f92672>(</span>virtiofs virtiofs0 926.4 GiB<span style=color:#f92672>)</span> ioping statistics ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>9</span> requests completed in 3.01 ms, <span style=color:#ae81ff>36</span> KiB read, 2.99 k iops, 11.7 MiB/s
</span></span><span style=display:flex><span>generated <span style=color:#ae81ff>10</span> requests in 9.00 s, <span style=color:#ae81ff>40</span> KiB, <span style=color:#ae81ff>1</span> iops, 4.44 KiB/s
</span></span><span style=display:flex><span>min/avg/max/mdev <span style=color:#f92672>=</span> 254.2 us / 334.5 us / 396.4 us / 46.5 us
</span></span></code></pre></div><h2 id=ram-disk-1>RAM Disk <a href=#ram-disk-1 class="hash g">#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/ramdisk <span style=color:#75715e># ioping -c 10 .</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> time<span style=color:#f92672>=</span>63.3 us <span style=color:#f92672>(</span>warmup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> time<span style=color:#f92672>=</span>201.5 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> time<span style=color:#f92672>=</span>204.0 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> time<span style=color:#f92672>=</span>327.4 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> time<span style=color:#f92672>=</span>297.5 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>6</span> time<span style=color:#f92672>=</span>202.9 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>7</span> time<span style=color:#f92672>=</span>390.1 us <span style=color:#f92672>(</span>slow<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span> time<span style=color:#f92672>=</span>288.0 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>9</span> time<span style=color:#f92672>=</span>311.8 us
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> KiB <span style=color:#f92672>&lt;&lt;&lt;</span> . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span>: request<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span> time<span style=color:#f92672>=</span>381.5 us
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>--- . <span style=color:#f92672>(</span>virtiofs virtiofs1 <span style=color:#ae81ff>2</span> GiB<span style=color:#f92672>)</span> ioping statistics ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>9</span> requests completed in 2.60 ms, <span style=color:#ae81ff>36</span> KiB read, 3.46 k iops, 13.5 MiB/s
</span></span><span style=display:flex><span>generated <span style=color:#ae81ff>10</span> requests in 9.00 s, <span style=color:#ae81ff>40</span> KiB, <span style=color:#ae81ff>1</span> iops, 4.44 KiB/s
</span></span><span style=display:flex><span>min/avg/max/mdev <span style=color:#f92672>=</span> 201.5 us / 289.4 us / 390.1 us / 69.2 us
</span></span></code></pre></div><h1 id=cleanup>Cleanup <a href=#cleanup class="hash g">#</a></h1><p>To remove the RAMdisk<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ diskutil unmount /dev/disk7
</span></span><span style=display:flex><span>Volume ramdisk on disk7 unmounted
</span></span><span style=display:flex><span>$ diskutil unmountDisk /dev/disk7
</span></span><span style=display:flex><span>Unmount of all volumes on disk7 was successful
</span></span></code></pre></div><h1 id=results>Results <a href=#results class="hash g">#</a></h1><p>Note that the tests are somewhat cursory, but from what we have the read/write IOPS are double with the RAM disk, and latency is slightly improved.</div></main>